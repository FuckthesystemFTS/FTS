<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Token FTS - Wallet</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers/dist/ethers.umd.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background-color: #f4f4f4;
      padding: 20px;
    }
    h1 {
      color: #333;
    }
    button {
      padding: 10px 15px;
      font-size: 16px;
      cursor: pointer;
      margin-top: 10px;
    }
    input {
      width: 80%;
      padding: 8px;
      margin: 5px 0;
      font-size: 16px;
    }
    #balance, #transferStatus {
      margin-top: 10px;
      font-weight: bold;
    }
  </style>
</head>
<body>

  <h1>Interazione con il Token FTS</h1>

  <button id="connectWallet">ðŸ”— Collega Wallet</button>
  <p id="account"></p>

  <div id="balanceSection" style="display:none;">
    <h2>ðŸ’° Saldo FTS</h2>
    <button id="getBalance">ðŸ”„ Aggiorna Saldo</button>
    <p id="balance"></p>
  </div>

  <div id="transferSection" style="display:none;">
    <h2>ðŸ“¤ Trasferisci FTS</h2>
    <input type="text" id="recipient" placeholder="Indirizzo destinatario (0x...)" required>
    <input type="number" id="amount" placeholder="QuantitÃ  FTS" step="any" required>
    <button id="sendTokens">ðŸš€ Invia</button>
    <p id="transferStatus"></p>
  </div>

  <script>
    let provider, signer, userAddress;
    const TOKEN_CONTRACT_ADDRESS = "0xF87993C72C40268FF93989810192e575D17CAfb0";
    const TOKEN_ABI = [
      "function transfer(address to, uint256 amount) public returns (bool)",
      "function balanceOf(address owner) public view returns (uint256)",
      "function decimals() public view returns (uint8)",
      "function name() public view returns (string)",
      "function symbol() public view returns (string)"
    ];

    document.getElementById("connectWallet").addEventListener("click", async () => {
      if (window.ethereum) {
        try {
          provider = new ethers.providers.Web3Provider(window.ethereum);
          await provider.send("eth_requestAccounts", []);
          signer = provider.getSigner();
          userAddress = await signer.getAddress();
          document.getElementById("account").innerText = "Wallet: " + userAddress;
          document.getElementById("balanceSection").style.display = "block";
          document.getElementById("transferSection").style.display = "block";
        } catch (err) {
          console.error(err);
          alert("Errore durante la connessione al wallet.");
        }
      } else {
        alert("Wallet non rilevato! Installa MetaMask.");
      }
    });

    document.getElementById("getBalance").addEventListener("click", async () => {
      if (!signer) return alert("Collega prima il wallet!");
      const tokenContract = new ethers.Contract(TOKEN_CONTRACT_ADDRESS, TOKEN_ABI, provider);
      try {
        const decimals = await tokenContract.decimals();
        let balance = await tokenContract.balanceOf(userAddress);
        balance = ethers.utils.formatUnits(balance, decimals);
        document.getElementById("balance").innerText = "Saldo: " + balance + " FTS";
      } catch (err) {
        console.error(err);
        alert("Errore nel recupero del saldo.");
      }
    });

    document.getElementById("sendTokens").addEventListener("click", async () => {
      if (!signer) return alert("Collega prima il wallet!");
      
      const recipient = document.getElementById("recipient").value;
      const amount = document.getElementById("amount").value;
      if (!ethers.utils.isAddress(recipient)) return alert("Indirizzo destinatario non valido!");

      const tokenContract = new ethers.Contract(TOKEN_CONTRACT_ADDRESS, TOKEN_ABI, signer);
      try {
        const decimals = await tokenContract.decimals();
        const amountParsed = ethers.utils.parseUnits(amount, decimals);
        const tx = await tokenContract.transfer(recipient, amountParsed);
        document.getElementById("transferStatus").innerText = "Transazione in corso... Hash: " + tx.hash;
        await tx.wait();
        document.getElementById("transferStatus").innerText = "âœ… Transazione completata!";
      } catch (err) {
        console.error(err);
        document.getElementById("transferStatus").innerText = "Errore: " + err.message;
      }
    });
  </script>

</body>
</html>
